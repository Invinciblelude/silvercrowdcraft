<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Projects Dashboard</title>
  <script src="auth.js"></script>
  <script src="assets/shared-nav.js?v=3"></script>
  <style>
    body {background:#0a0e27; color:#e8eef5}
    .container {max-width:1200px; margin:0 auto; padding:16px 16px 100px}
    h1 {color:#9cc1ff; margin-bottom:24px}
    .projects-grid {display:grid; grid-template-columns:repeat(auto-fill, minmax(320px, 1fr)); gap:20px}
    .project-card {
      background:#12161b;
      border:2px solid #667eea;
      border-radius:12px;
      padding:24px;
      color:#e8eef5;
      cursor:pointer;
      transition:transform 0.2s, box-shadow 0.2s, border-color 0.2s;
      text-decoration:none;
      display:block;
      box-shadow:0 4px 12px rgba(0,0,0,0.3);
    }
    .project-card:hover {
      transform:translateY(-4px); 
      box-shadow:0 8px 24px rgba(102,126,234,0.5);
      border-color:#9cc1ff;
    }
    .project-name {font-size:22px; font-weight:700; margin-bottom:8px; color:#9cc1ff}
    .project-address {font-size:14px; opacity:0.8; margin-bottom:16px; color:#a9b6c6}
    .project-meta {display:flex; justify-content:space-between; flex-wrap:wrap; gap:12px}
    .meta-item {display:flex; flex-direction:column}
    .meta-label {font-size:11px; opacity:0.7; text-transform:uppercase; letter-spacing:0.5px; color:#8a98ab}
    .meta-value {font-size:16px; font-weight:600; margin-top:4px; color:#e8eef5}
    .progress-bar {
      background:#1f2630;
      height:8px;
      border-radius:4px;
      margin-top:16px;
      overflow:hidden;
    }
    .progress-fill {background:#667eea; height:100%; transition:width 0.3s}
    .empty-state {text-align:center; padding:60px 20px; color:#8a98ab}
    .empty-state-icon {font-size:64px; margin-bottom:16px}
  </style>
</head>
<body data-jsdom-page="dashboard" data-jsdom-title="üìä Projects Dashboard">
  <div class="container">
    <h1>üèóÔ∏è Construction Projects</h1>
    <div class="projects-grid" id="projectsGrid"></div>
  </div>

<script>
    async function loadProjects() {
      try {
        // Load REAL construction plan
        const response = await fetch('assets/real_construction_plan.json');
        const data = await response.json();
        
        // For now, we have one project. In future, this could be an array.
        const projects = [{
          id: 'PROJ-001',
          name: data.project.name,
          address: data.project.address,
          status: 'In Progress',
          total_tasks: data.tasks.length,
          total_hours: data.summary.total_hours,
          completed_tasks: 0,
          progress: 0,
          scope: data.project.scope,
          architect: data.project.architect
        }];
        
        const grid = document.getElementById('projectsGrid');
        
        if (projects.length === 0) {
          grid.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">üèóÔ∏è</div>
              <h2>No Projects Yet</h2>
              <p>Add your first construction project to get started.</p>
            </div>
          `;
          return;
        }
        
        grid.innerHTML = projects.map(project => `
          <a href="project.html?id=${project.id}" class="project-card">
            <div class="project-name">${project.name}</div>
            <div class="project-address">üìç ${project.address}</div>
            <div class="project-meta">
              <div class="meta-item">
                <span class="meta-label">Status</span>
                <span class="meta-value">${project.status}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Tasks</span>
                <span class="meta-value">${project.completed_tasks}/${project.total_tasks}</span>
              </div>
              <div class="meta-item">
                <span class="meta-label">Total Hours</span>
                <span class="meta-value">${project.total_hours}h</span>
              </div>
            </div>
            <div class="progress-bar">
              <div class="progress-fill" style="width:${project.progress}%"></div>
            </div>
          </a>
        `).join('');
        
      } catch (err) {
        console.error('Failed to load projects:', err);
        document.getElementById('projectsGrid').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚ö†Ô∏è</div>
            <h2>Failed to Load Projects</h2>
            <p>${err.message}</p>
        </div>
        `;
      }
    }
    
    loadProjects();
</script>
</body>
</html>
