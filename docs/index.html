<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Projects Dashboard</title>
  <script src="auth.js"></script>
  <script src="assets/shared-nav.js?v=3"></script>
  <style>
    body {background:#0a0e27; color:#e8eef5}
    .container {max-width:1200px; margin:0 auto; padding:16px 16px 100px}
    h1 {color:#9cc1ff; margin-bottom:24px}
    .projects-grid {display:grid; grid-template-columns:repeat(auto-fill, minmax(320px, 1fr)); gap:20px}
    .project-card {
      background:#12161b;
      border:2px solid #667eea;
      border-radius:12px;
      padding:24px;
      color:#e8eef5;
      cursor:pointer;
      transition:transform 0.2s, box-shadow 0.2s, border-color 0.2s;
      text-decoration:none;
      display:block;
      box-shadow:0 4px 12px rgba(0,0,0,0.3);
    }
    .project-card:hover {
      transform:translateY(-4px); 
      box-shadow:0 8px 24px rgba(102,126,234,0.5);
      border-color:#9cc1ff;
    }
    .project-name {font-size:22px; font-weight:700; margin-bottom:8px; color:#9cc1ff}
    .project-address {font-size:14px; opacity:0.8; margin-bottom:16px; color:#a9b6c6}
    .project-meta {display:flex; justify-content:space-between; flex-wrap:wrap; gap:12px}
    .meta-item {display:flex; flex-direction:column}
    .meta-label {font-size:11px; opacity:0.7; text-transform:uppercase; letter-spacing:0.5px; color:#8a98ab}
    .meta-value {font-size:16px; font-weight:600; margin-top:4px; color:#e8eef5}
    .progress-bar {
      background:#1f2630;
      height:8px;
      border-radius:4px;
      margin-top:16px;
      overflow:hidden;
    }
    .progress-fill {background:#667eea; height:100%; transition:width 0.3s}
    .empty-state {text-align:center; padding:60px 20px; color:#8a98ab}
    .empty-state-icon {font-size:64px; margin-bottom:16px}
  </style>
</head>
<body data-jsdom-page="dashboard" data-jsdom-title="üìä Projects Dashboard">
  <div class="container">
    <h1>üèóÔ∏è Construction Projects</h1>
    <div class="projects-grid" id="projectsGrid"></div>
  </div>

<script>
    async function loadProjects() {
      try {
        // Load both projects
        const [cordantResponse, nerradsResponse] = await Promise.all([
          fetch('assets/real_construction_plan.json'),
          fetch('assets/nerrads_project_data.json')
        ]);
        
        const cordantData = await cordantResponse.json();
        const nerradsData = await nerradsResponse.json();
        
        // Build projects array
        const projects = [
          {
            id: 'PROJ-001',
            name: cordantData.project.name,
            address: cordantData.project.address,
            status: 'In Progress',
            type: 'Construction',
            total_tasks: cordantData.tasks.length,
            total_hours: cordantData.summary.total_hours,
            completed_tasks: 0,
            progress: 0,
            link: 'project.html?id=PROJ-001'
          },
          {
            id: 'PROJ-002',
            name: nerradsData.project.name,
            address: nerradsData.project.address,
            status: 'Planning',
            type: 'Subdivision',
            total_tasks: nerradsData.summary.total_lots,
            total_cost: nerradsData.summary.total_cost,
            estimated_profit: nerradsData.summary.estimated_profit,
            roi: nerradsData.summary.roi_percentage,
            progress: nerradsData.derisking_status.percentage_complete,
            link: 'nerrads-project.html'
          }
        ];
        
        const grid = document.getElementById('projectsGrid');
        
        if (projects.length === 0) {
          grid.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">üèóÔ∏è</div>
              <h2>No Projects Yet</h2>
              <p>Add your first construction project to get started.</p>
            </div>
          `;
          return;
        }
        
        grid.innerHTML = projects.map(project => {
          if (project.type === 'Construction') {
            return `
              <a href="${project.link}" class="project-card">
                <div class="project-name">${project.name}</div>
                <div class="project-address">üìç ${project.address}</div>
                <div class="project-meta">
                  <div class="meta-item">
                    <span class="meta-label">Type</span>
                    <span class="meta-value">üèóÔ∏è ${project.type}</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Tasks</span>
                    <span class="meta-value">${project.completed_tasks}/${project.total_tasks}</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Total Hours</span>
                    <span class="meta-value">${project.total_hours}h</span>
                  </div>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width:${project.progress}%"></div>
                </div>
              </a>
            `;
          } else {
            // Subdivision project
            return `
              <a href="${project.link}" class="project-card">
                <div class="project-name">${project.name}</div>
                <div class="project-address">üìç ${project.address}</div>
                <div class="project-meta">
                  <div class="meta-item">
                    <span class="meta-label">Type</span>
                    <span class="meta-value">üèòÔ∏è ${project.type}</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Lots</span>
                    <span class="meta-value">${project.total_tasks}</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">Est. Profit</span>
                    <span class="meta-value">$${(project.estimated_profit/1000).toFixed(0)}K</span>
                  </div>
                  <div class="meta-item">
                    <span class="meta-label">ROI</span>
                    <span class="meta-value">${project.roi}%</span>
                  </div>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill" style="width:${project.progress}%"></div>
                </div>
                <div style="margin-top:12px; font-size:12px; color:#8a98ab;">
                  ‚úÖ ${project.progress}% De-Risked
                </div>
              </a>
            `;
          }
        }).join('');
        
      } catch (err) {
        console.error('Failed to load projects:', err);
        document.getElementById('projectsGrid').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">‚ö†Ô∏è</div>
            <h2>Failed to Load Projects</h2>
            <p>${err.message}</p>
        </div>
        `;
      }
    }
    
    loadProjects();
</script>
</body>
</html>
