<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Project Tasks</title>
  <script src="auth.js"></script>
  <script src="assets/shared-nav.js?v=3"></script>
  <style>
    body {background:#0a0e27; color:#e8eef5}
    .container {max-width:1200px; margin:0 auto; padding:16px 16px 100px}
    .header {margin-bottom:24px}
    .back-btn {display:inline-block; background:#303947; color:#e8eef5; padding:10px 20px; border-radius:6px; text-decoration:none; margin-bottom:16px}
    .back-btn:hover {background:#3d4757}
    h1 {color:#9cc1ff; margin:8px 0}
    .project-info {display:flex; gap:24px; flex-wrap:wrap; margin:16px 0; padding:16px; background:#12161b; border:1px solid #1f2630; border-radius:8px}
    .info-item {display:flex; flex-direction:column}
    .info-label {font-size:11px; color:#8a98ab; text-transform:uppercase}
    .info-value {font-size:16px; color:#e8eef5; font-weight:600; margin-top:4px}
    
    .filters {display:flex; gap:12px; flex-wrap:wrap; margin:20px 0}
    .filters input, .filters select {background:#0f1317; border:1px solid #303947; color:#e8eef5; padding:10px 16px; border-radius:6px; font-size:14px}
    .filters input {flex:1; min-width:250px}
    
    .trade-section {margin:32px 0}
    .trade-header {
      background:linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      color:#fff;
      padding:12px 20px;
      border-radius:8px;
      font-size:20px;
      font-weight:700;
      display:flex;
      justify-content:space-between;
      align-items:center;
      cursor:pointer;
    }
    .trade-header:hover {opacity:0.9}
    .trade-count {font-size:14px; opacity:0.9}
    
    .tasks-list {padding:16px 0}
    .task-card {
      background:#12161b;
      border-left:4px solid #667eea;
      border-radius:6px;
      padding:16px;
      margin:12px 0;
      transition:transform 0.2s, box-shadow 0.2s;
      color:#e8eef5;
      position:relative;
    }
    .task-card:hover {transform:translateX(4px); box-shadow:0 4px 12px rgba(0,0,0,0.3)}
    .task-link {text-decoration:none; color:inherit; display:block}
    .task-actions {display:flex; gap:12px; align-items:center; margin-top:12px; padding-top:12px; border-top:1px solid #1f2630}
    .status-select {background:#1f2630; border:1px solid #303947; color:#e8eef5; padding:8px 12px; border-radius:6px; cursor:pointer; font-size:14px}
    .status-select:hover {background:#303947}
    .complete-btn {background:#28a745; color:#fff; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-weight:600}
    .complete-btn:hover {background:#218838}
    .photo-btn {background:#667eea; color:#fff; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-weight:600}
    .photo-btn:hover {background:#5568d3}
    .notes-btn {background:#ffc107; color:#000; border:none; padding:8px 16px; border-radius:6px; cursor:pointer; font-weight:600}
    .notes-btn:hover {background:#e0a800}
    .task-photos {display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; padding:12px; background:#0f1317; border-radius:6px; border:1px solid #303947}
    .task-photo {width:100px; height:100px; object-fit:cover; border-radius:6px; border:2px solid #667eea; cursor:pointer; transition:transform 0.2s, border-color 0.2s}
    .task-photo:hover {transform:scale(1.05); border-color:#9cc1ff}
    .task-notes {background:#1f2630; padding:12px; border-radius:4px; margin-top:8px; font-size:12px; color:#a9b6c6}
    .note-entry {margin:8px 0; padding:8px; background:#12161b; border-radius:4px; border-left:3px solid #ffc107}
    .note-timestamp {font-size:10px; color:#8a98ab; margin-bottom:4px}
    .note-text {color:#e8eef5; line-height:1.4}
    .task-header {display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:12px}
    .task-id {font-size:12px; color:#667eea; font-weight:700}
    .task-name {font-size:18px; font-weight:600; margin-top:4px}
    .task-status {
      padding:4px 12px;
      border-radius:12px;
      font-size:12px;
      font-weight:600;
    }
    .status-pending {background:#444; color:#aaa}
    .status-in-progress {background:#1a3a52; color:#4da6ff}
    .status-complete {background:#1a4d2e; color:#4ade80}
    
    .task-meta {display:flex; gap:20px; flex-wrap:wrap; margin-top:12px}
    .task-meta-item {font-size:13px; color:#9ca9bb}
    .task-meta-item strong {color:#e8eef5}
    
    .empty-state {text-align:center; padding:40px 20px; color:#8a98ab}
  </style>
</head>
<body data-jsdom-page="tasks" data-jsdom-title="üìã Project Tasks">
  <div class="container">
    <div class="header">
      <a href="index.html" class="back-btn">‚Üê Back to Dashboard</a>
      <h1 id="projectName">Loading...</h1>
      <div class="project-info" id="projectInfo"></div>
      <div id="quickLinks" style="display:flex; gap:12px; flex-wrap:wrap; margin-top:8px"></div>
    </div>
    
    <div class="filters">
      <input type="text" id="searchInput" placeholder="üîç Search: roof, kitchen, shear wall, plumbing..." style="flex:1; min-width:300px" />
      <select id="statusFilter">
        <option value="">All Status</option>
        <option value="pending">Pending</option>
        <option value="in-progress">In Progress</option>
        <option value="complete">Complete</option>
      </select>
    </div>
    <div class="search-hint" style="font-size:12px; color:#8a98ab; margin:-12px 0 20px 0">
      üí° Try: "roof", "kitchen", "2x8", "shear wall", "inspection", "Tim's Island", "K-3324 toilet"
    </div>
    
    <div id="tasksContainer"></div>
  </div>

  <script>
    let allTasks = [];
    let projectData = null;
    
    async function loadProject() {
      const urlParams = new URLSearchParams(window.location.search);
      const projectId = urlParams.get('id') || 'PROJ-001';
      
      try {
        // Load REAL construction plan from blueprints
        const response = await fetch('assets/real_construction_plan.json');
        const data = await response.json();
        projectData = data.project;
        allTasks = data.tasks;
        
        // Load saved task states from localStorage
        const savedStates = JSON.parse(localStorage.getItem('taskStates') || '{}');
        allTasks = allTasks.map(task => {
          const savedState = savedStates[task.id] || {};
          
          // Migrate old notes format to new notesList format
          let notesList = savedState.notesList || [];
          if (!notesList.length && savedState.notes && savedState.notes.trim()) {
            // If there's old notes but no notesList, convert it
            notesList = [{
              text: savedState.notes,
              timestamp: 'Migrated from old format'
            }];
          }
          
          return {
            ...task,
            status: savedState.status || 'pending',
            actual_hours: savedState.actual_hours || 0,
            completed_by: savedState.completed_by || '',
            completed_date: savedState.completed_date || null,
            photos: savedState.photos || [],
            notes: savedState.notes || '',
            notesList: notesList,
            changelog: savedState.changelog || []
          };
        });
        
        renderProject();
        renderTasks(allTasks);
        
      } catch (err) {
        console.error('Failed to load project:', err);
        document.getElementById('projectName').textContent = 'Error Loading Project';
      }
    }
    
    function renderProject() {
      document.getElementById('projectName').textContent = projectData.name;
      
      const completedTasks = allTasks.filter(t => t.status === 'complete').length;
      const inProgressTasks = allTasks.filter(t => t.status === 'in-progress').length;
      const totalHours = allTasks.reduce((sum, t) => sum + t.duration_hours, 0);
      
      document.getElementById('projectInfo').innerHTML = `
        <div class="info-item">
          <span class="info-label">Address</span>
          <span class="info-value">${projectData.address}</span>
        </div>
        <div class="info-item">
          <span class="info-label">Scope</span>
          <span class="info-value">${projectData.new_addition_sf} SF Addition</span>
        </div>
        <div class="info-item">
          <span class="info-label">Progress</span>
          <span class="info-value">${completedTasks}/${allTasks.length} tasks</span>
        </div>
        <div class="info-item">
          <span class="info-label">In Progress</span>
          <span class="info-value">${inProgressTasks} active</span>
        </div>
        <div class="info-item">
          <span class="info-label">Total Hours</span>
          <span class="info-value">${totalHours}h</span>
        </div>
        <div class="info-item">
          <span class="info-label">Architect</span>
          <span class="info-value">${projectData.architect}</span>
        </div>
      `;

      // Quick links for 728 Cordant
      const quick = document.getElementById('quickLinks');
      quick.innerHTML = `
        <a href="cordant-blueprints.html" style="background:#667eea; color:#fff; padding:10px 16px; border-radius:8px; text-decoration:none; font-weight:600">üìê Blueprints</a>
        <a href="house-2d-preview.html" style="background:#1f2630; color:#9cc1ff; padding:10px 16px; border-radius:8px; text-decoration:none; font-weight:600; border:1px solid #667eea">üìè House 2D Preview</a>
        <a href="2d-cad-viewer.html" style="background:#1f2630; color:#9cc1ff; padding:10px 16px; border-radius:8px; text-decoration:none; font-weight:600; border:1px solid #667eea">üñºÔ∏è 2D CAD Viewer</a>
      `;
    }
    
    function renderTasks(tasks) {
      console.log('üé® Rendering tasks:', {
        totalTasks: tasks.length,
        tasksWithPhotos: tasks.filter(t => t.photos && t.photos.length > 0).length,
        tasksWithNotes: tasks.filter(t => t.notesList && t.notesList.length > 0).length
      });
      
      // Group tasks by phase (not trade, since real data uses "phase")
      const tasksByPhase = {};
      tasks.forEach(task => {
        const phase = task.phase || task.trade || 'General';
        if (!tasksByPhase[phase]) {
          tasksByPhase[phase] = [];
        }
        tasksByPhase[phase].push(task);
      });
      
      const container = document.getElementById('tasksContainer');
      
      if (tasks.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <h3>No tasks found</h3>
            <p>Try adjusting your filters</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = Object.entries(tasksByPhase).map(([phase, phaseTasks]) => `
        <div class="trade-section">
          <div class="trade-header">
            <span>${phase}</span>
            <span class="trade-count">${phaseTasks.length} tasks ‚Ä¢ ${phaseTasks.reduce((sum, t) => sum + t.duration_hours, 0)}h</span>
          </div>
          <div class="tasks-list">
            ${phaseTasks.map(task => `
              <div class="task-card">
                <a href="sops/${task.id}.html" class="task-link">
                  <div class="task-header">
                    <div>
                      <div class="task-id">${task.id}</div>
                      <div class="task-name">${task.name}</div>
                    </div>
                    <span class="task-status status-${task.status}">${task.status.replace('-', ' ')}</span>
                  </div>
                  <div class="task-meta">
                    <span class="task-meta-item"><strong>${task.days}</strong> days | <strong>${task.crew_assigned}</strong> crew | <strong>${task.duration_hours}h</strong></span>
                    <span class="task-meta-item">üìÖ ${task.start_date} to ${task.end_date}</span>
                    ${task.from_plans ? `<span class="task-meta-item" style="font-size:11px;color:#667eea">üìã ${task.from_plans}</span>` : ''}
                    ${task.blueprint_pages && task.blueprint_pages.length > 0 ? `<span class="task-meta-item" style="font-size:11px;color:#9cc1ff">üìê ${task.blueprint_pages.length} blueprints</span>` : ''}
                  </div>
                </a>
                <div class="task-actions">
                  <select class="status-select" onchange="updateTaskStatus('${task.id}', this.value)" onclick="event.stopPropagation()">
                    <option value="pending" ${task.status === 'pending' ? 'selected' : ''}>‚è≥ Pending</option>
                    <option value="in-progress" ${task.status === 'in-progress' ? 'selected' : ''}>üî® In Progress</option>
                    <option value="complete" ${task.status === 'complete' ? 'selected' : ''}>‚úÖ Complete</option>
                  </select>
                  ${task.status !== 'complete' ? `<button class="complete-btn" onclick="quickComplete('${task.id}'); event.stopPropagation()">‚úÖ Complete</button>` : ''}
                  <button class="photo-btn" onclick="addPhoto('${task.id}'); event.stopPropagation()">üì∑ Photo ${task.photos && task.photos.length > 0 ? `(${task.photos.length})` : ''}</button>
                  <button class="notes-btn" onclick="addNote('${task.id}'); event.stopPropagation()">üìù Note</button>
                </div>
                ${task.photos && task.photos.length > 0 ? `
                  <div class="task-photos">
                    <div style="width:100%; margin-bottom:8px; font-size:12px; color:#8a98ab;">üì∑ ${task.photos.length} photo${task.photos.length > 1 ? 's' : ''}</div>
                    ${task.photos.map((photo, i) => `<img src="${photo.url}" class="task-photo" onclick="viewPhoto('${task.id}', ${i})" title="${photo.note || 'Photo ' + (i+1)}" onerror="console.error('Failed to load photo:', '${task.id}', ${i})" />`).join('')}
                  </div>
                ` : ''}
                ${task.notesList && task.notesList.length > 0 ? `
                  <div class="task-notes">
                    <div style="font-weight:600; margin-bottom:8px; color:#ffc107;">üìù Notes (${task.notesList.length})</div>
                    ${task.notesList.map(note => `
                      <div class="note-entry">
                        <div class="note-timestamp">${note.timestamp}</div>
                        <div class="note-text">${note.text}</div>
                      </div>
                    `).join('')}
                  </div>
                ` : ''}
              </div>
            `).join('')}
          </div>
        </div>
      `).join('');
    }
    
    // Search and filter
    document.addEventListener('DOMContentLoaded', () => {
      const searchInput = document.getElementById('searchInput');
      const statusFilter = document.getElementById('statusFilter');
      
      function filterTasks() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        const statusValue = statusFilter.value;
        
        if (!searchTerm && !statusValue) {
          renderTasks(allTasks);
          return;
        }
        
        const filtered = allTasks.filter(task => {
          // Search in multiple fields
          const phase = (task.phase || task.trade || '').toLowerCase();
          const taskName = task.name.toLowerCase();
          const taskId = task.id.toLowerCase();
          const fromPlans = (task.from_plans || '').toLowerCase();
          
          // Also search in blueprint sheet numbers
          const blueprintSheets = task.blueprint_pages 
            ? task.blueprint_pages.map(bp => bp.sheet_num).join(' ').toLowerCase()
            : '';
          
          const matchesSearch = !searchTerm || 
                              taskName.includes(searchTerm) ||
                              taskId.includes(searchTerm) ||
                              phase.includes(searchTerm) ||
                              fromPlans.includes(searchTerm) ||
                              blueprintSheets.includes(searchTerm);
          
          const matchesStatus = !statusValue || task.status === statusValue;
          return matchesSearch && matchesStatus;
        });
        
        renderTasks(filtered);
        
        // Show results count
        const hint = document.querySelector('.search-hint');
        if (hint && searchTerm) {
          hint.textContent = `Found ${filtered.length} task${filtered.length !== 1 ? 's' : ''} matching "${searchInput.value}"`;
        } else if (hint) {
          hint.textContent = 'üí° Try: "roof", "kitchen", "2x8", "shear wall", "inspection", "Tim\'s Island", "K-3324 toilet"';
        }
      }
      
      searchInput.addEventListener('input', filterTasks);
      statusFilter.addEventListener('change', filterTasks);
    });
    
    // Update task status
    function updateTaskStatus(taskId, newStatus) {
      const task = allTasks.find(t => t.id === taskId);
      if (task) {
        task.status = newStatus;
        saveTaskStates();
        renderTasks(allTasks);
        loadProject(); // Refresh stats
      }
    }
    
    // Quick complete button
    function quickComplete(taskId) {
      updateTaskStatus(taskId, 'complete');
      alert(`‚úÖ Task ${taskId} marked as complete!`);
    }
    
    // Save task states to localStorage
    function saveTaskStates() {
      const states = {};
      allTasks.forEach(task => {
        states[task.id] = {
          status: task.status,
          actual_hours: task.actual_hours || 0,
          completed_by: task.completed_by || '',
          completed_date: task.status === 'complete' ? new Date().toISOString() : null,
          photos: task.photos || [],
          notes: task.notes || '',
          notesList: task.notesList || [],
          changelog: task.changelog || []
        };
      });
      
      const statesJson = JSON.stringify(states);
      console.log('üíæ Saving task states:', {
        totalTasks: Object.keys(states).length,
        dataSize: (statesJson.length / 1024).toFixed(2) + ' KB',
        tasksWithPhotos: Object.values(states).filter(s => s.photos && s.photos.length > 0).length
      });
      
      localStorage.setItem('taskStates', statesJson);
      console.log('‚úÖ Task states saved to localStorage');
      saveChangelog();
    }
    
    // Check localStorage usage
    function getStorageInfo() {
      try {
        const used = JSON.stringify(localStorage).length;
        const limit = 5 * 1024 * 1024; // ~5MB typical limit
        return {
          used: used,
          usedMB: (used / 1024 / 1024).toFixed(2),
          limit: limit,
          limitMB: (limit / 1024 / 1024).toFixed(2),
          percentUsed: ((used / limit) * 100).toFixed(1),
          available: limit - used,
          availableMB: ((limit - used) / 1024 / 1024).toFixed(2)
        };
      } catch (e) {
        return null;
      }
    }
    
    // Compress image before saving
    function compressImage(file, maxWidth = 800, quality = 0.7) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = new Image();
          img.onload = function() {
            const canvas = document.createElement('canvas');
            let width = img.width;
            let height = img.height;
            
            // Resize if too large
            if (width > maxWidth) {
              height = (height * maxWidth) / width;
              width = maxWidth;
            }
            
            canvas.width = width;
            canvas.height = height;
            
            const ctx = canvas.getContext('2d');
            ctx.drawImage(img, 0, 0, width, height);
            
            // Convert to compressed JPEG
            const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
            resolve(compressedDataUrl);
          };
          img.onerror = reject;
          img.src = e.target.result;
        };
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }
    
    // Add photo to task
    function addPhoto(taskId) {
      const task = allTasks.find(t => t.id === taskId);
      if (!task) return;
      
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.capture = 'camera'; // Use camera on mobile
      
      input.onchange = async function(e) {
        const file = e.target.files[0];
        if (!file) return;
        
        // Don't block with alert - just log
        console.log('üì∏ Processing image...');
        
        try {
          // Compress the image
          const compressedDataUrl = await compressImage(file, 800, 0.7);
          const photoNote = prompt('Add a note for this photo (optional):');
          
          if (!task.photos) task.photos = [];
          
          const originalSize = file.size;
          const compressedSize = Math.round((compressedDataUrl.length * 3) / 4); // Estimate base64 size
          
          const photoData = {
            url: compressedDataUrl,
            note: photoNote,
            date: new Date().toISOString(),
            filename: file.name
          };
          
          task.photos.push(photoData);
          
          console.log('üì∑ Photo added (compressed):', {
            taskId: taskId,
            filename: file.name,
            originalSize: (originalSize / 1024).toFixed(2) + ' KB',
            compressedSize: (compressedSize / 1024).toFixed(2) + ' KB',
            savings: ((1 - compressedSize/originalSize) * 100).toFixed(1) + '%',
            totalPhotos: task.photos.length
          });
          
          addToChangelog(taskId, `üì∑ Photo added: ${photoNote || file.name}`);
          
          // Check storage before saving
          const storageInfo = getStorageInfo();
          console.log('üíæ Storage info:', storageInfo);
          
          if (storageInfo && storageInfo.percentUsed > 90) {
            alert(`‚ö†Ô∏è Storage almost full (${storageInfo.percentUsed}%)!\n\nUsed: ${storageInfo.usedMB}MB / ${storageInfo.limitMB}MB\n\nWarning: You may not be able to add many more photos. Consider clearing old data.`);
          }
          
          try {
            saveTaskStates();
            console.log('‚úÖ Task states saved to localStorage');
          } catch (e) {
            console.error('‚ùå Error saving to localStorage:', e);
            const info = getStorageInfo();
            alert(`‚ùå Storage full! Cannot save photo.\n\nStorage used: ${info ? info.usedMB + 'MB' : 'Unknown'}\n\nTo fix:\n1. Open browser settings\n2. Clear site data for silvercrowdcraft.com\n3. Or use browser console: localStorage.clear()\n\nNote: This will clear all saved task data and photos.`);
            task.photos.pop(); // Remove the photo that failed to save
            return;
          }
          
          renderTasks(allTasks);
          
          // Show confirmation
          alert(`‚úÖ Photo uploaded!\n\nOriginal: ${(originalSize/1024).toFixed(0)}KB\nCompressed: ${(compressedSize/1024).toFixed(0)}KB\nSaved ${((1 - compressedSize/originalSize) * 100).toFixed(0)}% space!\n\nTotal photos: ${task.photos.length}`);
          
        } catch (error) {
          console.error('Error processing image:', error);
          alert('‚ùå Error processing image: ' + error.message);
        }
      };
      
      input.click();
    }
    
    // View photo full size
    function viewPhoto(taskId, photoIndex) {
      const task = allTasks.find(t => t.id === taskId);
      if (!task || !task.photos || !task.photos[photoIndex]) return;
      
      const photo = task.photos[photoIndex];
      const modal = document.createElement('div');
      modal.style.cssText = 'position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; display:flex; flex-direction:column; align-items:center; justify-content:center; padding:20px';
      
      const img = document.createElement('img');
      img.src = photo.url;
      img.style.cssText = 'max-width:90%; max-height:80%; object-fit:contain; border-radius:8px';
      
      const info = document.createElement('div');
      info.style.cssText = 'color:#fff; margin-top:16px; text-align:center';
      info.innerHTML = `
        <div style="font-size:14px; margin-bottom:8px">${photo.note || 'Photo ' + (photoIndex + 1)}</div>
        <div style="font-size:12px; opacity:0.7">${new Date(photo.date).toLocaleString()}</div>
        <button onclick="this.parentElement.parentElement.remove()" style="margin-top:12px; padding:8px 20px; background:#dc3545; color:#fff; border:none; border-radius:6px; cursor:pointer">Close</button>
      `;
      
      modal.appendChild(img);
      modal.appendChild(info);
      modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
      document.body.appendChild(modal);
    }
    
    // Add note to task
    function addNote(taskId) {
      const task = allTasks.find(t => t.id === taskId);
      if (!task) return;
      
      const newNote = prompt('Add a note for this task:');
      if (newNote && newNote.trim()) {
        // Initialize notes array if it doesn't exist
        if (!task.notesList) task.notesList = [];
        
        // Add new note with timestamp
        const timestamp = new Date().toLocaleString();
        const noteEntry = {
          text: newNote.trim(),
          timestamp: timestamp
        };
        task.notesList.push(noteEntry);
        
        // Keep legacy notes field updated with all notes
        task.notes = task.notesList.map(n => `[${n.timestamp}] ${n.text}`).join('\n\n');
        
        addToChangelog(taskId, `üìù Note added: ${newNote.substring(0, 50)}${newNote.length > 50 ? '...' : ''}`);
        saveTaskStates();
        renderTasks(allTasks);
      }
    }
    
    // Add entry to changelog
    function addToChangelog(taskId, message) {
      const task = allTasks.find(t => t.id === taskId);
      if (!task) return;
      
      if (!task.changelog) task.changelog = [];
      task.changelog.push({
        date: new Date().toISOString(),
        message: message,
        user: 'Foreman' // Could be dynamic
      });
    }
    
    // Save changelog to localStorage
    function saveChangelog() {
      const changelog = [];
      allTasks.forEach(task => {
        if (task.changelog && task.changelog.length > 0) {
          task.changelog.forEach(entry => {
            changelog.push({
              taskId: task.id,
              taskName: task.name,
              ...entry
            });
          });
        }
      });
      changelog.sort((a, b) => new Date(b.date) - new Date(a.date));
      localStorage.setItem('projectChangelog', JSON.stringify(changelog));
    }
    
    loadProject();
  </script>
</body>
</html>

