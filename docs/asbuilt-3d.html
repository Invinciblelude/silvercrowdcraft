<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>728 Cordant - As-Built 3D White Model</title>
  <script src="auth.js"></script>
  <script src="assets/shared-nav.js?v=3"></script>
  <style>
    html, body {margin:0; height:100%; background:#0a0e27; color:#e8eef5; font-family:system-ui,-apple-system,sans-serif}
    #app {position:fixed; inset:0}
    .hud {position:fixed; left:16px; top:16px; z-index:10; background:rgba(18,22,27,0.85); border:1px solid #1f2630; border-radius:12px; padding:12px 16px; backdrop-filter: blur(6px)}
    .hud h1 {margin:0 0 8px; font-size:18px; color:#9cc1ff}
    .hud p {margin:4px 0; font-size:12px; color:#a9b6c6}
    .linkbar {position:fixed; right:16px; top:16px; display:flex; gap:8px}
    .btn {background:#667eea; color:#fff; border:none; border-radius:8px; padding:8px 12px; font-weight:600; cursor:pointer}
    .btn.alt {background:#1f2630; border:1px solid #667eea}
  </style>
</head>
<body data-jsdom-page="asbuilt-3d" data-jsdom-title="ðŸ  Asâ€‘Built 3D">
  <div class="hud">
    <h1>Asâ€‘Built 3D White Model</h1>
    <p>Footprint: 03â€‘AsBuiltâ€‘FloorPlan â€¢ Heights: 05â€‘AsBuiltâ€‘Elevations</p>
    <p>Controls: Drag = orbit â€¢ Scroll = zoom â€¢ Shift+Drag = pan â€¢ R = reset view</p>
  </div>
  <div class="linkbar">
    <a class="btn alt" href="2d-cad-viewer.html">2D Viewer</a>
    <a class="btn alt" href="build-sequence-viewer.html">Build Sequence</a>
  </div>
  <div id="app"></div>

  <script src="https://unpkg.com/three@0.160.0/build/three.min.js"></script>
  <script src="https://unpkg.com/three@0.160.0/examples/js/controls/OrbitControls.js"></script>
  <script>
    const app = document.getElementById('app');

    const scene = new THREE.Scene();
    const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 20000);
    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setClearColor('#0a0e27', 1);
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    app.appendChild(renderer.domElement);

    const controls = new THREE.OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // Lights
    scene.add(new THREE.AmbientLight(0xffffff, 1.2));
    const dir = new THREE.DirectionalLight(0xffffff, 0.8); dir.position.set(800,1000,600); scene.add(dir);

    // Grid + Axes
    const grid = new THREE.GridHelper(8000, 80, 0x334155, 0x1f2937); scene.add(grid);
    const axes = new THREE.AxesHelper(200); scene.add(axes);

    // Dimensions (placeholder; will be replaced by OCR values)
    const footprint = { length: 1600, width: 1100 }; // inches
    const wallH = 120; // use a taller default to ensure visibility
    const wallT = 8;

    // Foundation
    const slab = new THREE.Mesh(new THREE.BoxGeometry(footprint.length, 8, footprint.width), new THREE.MeshStandardMaterial({color:'#d1d5db'}));
    slab.position.set(0, 4, 0);
    scene.add(slab);

    // Walls (white)
    const wallMat = new THREE.MeshStandardMaterial({color:'#f3f4f6', roughness:0.8});
    const north = new THREE.Mesh(new THREE.BoxGeometry(footprint.length, wallH, wallT), wallMat); north.position.set(0, wallH/2+8, -footprint.width/2 + wallT/2); scene.add(north);
    const south = new THREE.Mesh(new THREE.BoxGeometry(footprint.length, wallH, wallT), wallMat); south.position.set(0, wallH/2+8,  footprint.width/2 - wallT/2); scene.add(south);
    const west  = new THREE.Mesh(new THREE.BoxGeometry(wallT, wallH, footprint.width), wallMat); west.position.set(-footprint.length/2 + wallT/2, wallH/2+8, 0); scene.add(west);
    const east  = new THREE.Mesh(new THREE.BoxGeometry(wallT, wallH, footprint.width), wallMat); east.position.set( footprint.length/2 - wallT/2, wallH/2+8, 0); scene.add(east);

    // Roof mass
    const roof = new THREE.Mesh(new THREE.BoxGeometry(footprint.length+60, 24, footprint.width+60), new THREE.MeshStandardMaterial({color:'#e5e7eb'}));
    roof.position.set(0, wallH + 20, 0);
    scene.add(roof);

    // Bright wireframe box to guarantee visibility
    const bbox = new THREE.LineSegments(
      new THREE.EdgesGeometry(new THREE.BoxGeometry(footprint.length+120, wallH+80, footprint.width+120)),
      new THREE.LineBasicMaterial({color: 0x67e8f9, linewidth: 2})
    );
    bbox.position.set(0, (wallH+80)/2, 0);
    scene.add(bbox);

    // Camera framing
    function frameAll() {
      const box = new THREE.Box3().setFromObject(bbox);
      const size = box.getSize(new THREE.Vector3());
      const center = box.getCenter(new THREE.Vector3());
      const maxDim = Math.max(size.x, size.y, size.z);
      const dist = maxDim * 1.4;
      camera.position.set(center.x + dist, center.y + dist*0.7, center.z + dist);
      controls.target.copy(center);
      controls.update();
    }
    frameAll();

    window.addEventListener('keydown', (e)=>{ if(e.key.toLowerCase()==='r'){ frameAll(); }});

    window.addEventListener('resize', ()=>{
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

    (function animate(){
      requestAnimationFrame(animate);
      controls.update();
      renderer.render(scene, camera);
    })();
  </script>
</body>
</html>
